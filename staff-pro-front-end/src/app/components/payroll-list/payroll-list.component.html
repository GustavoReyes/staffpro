<!-- <div class="min-h-screen bg-[#1e2226] p-4">
  <div class="max-w-7xl mx-auto">
 -->
<div class="min-h-screen flex items-center justify-center bg-[#1e2226] p-2">
  <div
    class="w-full max-w-5xl rounded-2xl overflow-hidden shadow-2xl bg-[#23272A] p-6"
  >
    <ng-container *ngIf="isLoaded">
      <ng-container *ngIf="isAdmin; else noPriv">
        <!-- Filtros -->
        <div class="bg-[#23272A] p-6 rounded-lg shadow-lg mb-6">
          <h2 class="text-2xl font-bold text-white mb-4">Filtrar Nóminas</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-gray-300 text-sm font-bold mb-2"
                >Departamento</label
              >
              <select
                title="Selecciona Departamento"
                [(ngModel)]="selectedDepartment"
                (change)="onDepartmentChange()"
                class="w-full px-4 py-2 rounded bg-[#181C1F] border border-[#23272A] text-white"
              >
                <option value="">Todos los departamentos</option>
                <option *ngFor="let dept of departments" [value]="dept.id">
                  {{ dept.name }}
                </option>
              </select>
            </div>
            <div>
              <label class="block text-gray-300 text-sm font-bold mb-2"
                >Empleado</label
              >
              <select
                title="Selecciona Empleado"
                [(ngModel)]="selectedDni"
                (change)="onEmployeeChange()"
                [disabled]="!selectedDepartment"
                class="w-full px-4 py-2 rounded bg-[#181C1F] border border-[#23272A] text-white"
              >
                <option value="">Todos los empleados</option>
                <option *ngFor="let emp of filteredEmployees" [value]="emp.dni">
                  {{ emp.dni }} - {{ emp.name }}
                </option>
              </select>
            </div>
          </div>
          <!-- Dentro del div de filtros, añade esto después de los selectores existentes -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
            <div>
              <label class="block text-gray-300 text-sm font-bold mb-2"
                >Año</label
              >
              <select
                title="Selecciona Año"
                [(ngModel)]="selectedYear"
                (change)="onDateFilterChange()"
                class="w-full px-4 py-2 rounded bg-[#181C1F] border border-[#23272A] text-white"
              >
                <option value="">Todos los años</option>
                <option *ngFor="let year of availableYears" [value]="year">
                  {{ year }}
                </option>
              </select>
            </div>
            <div>
              <label class="block text-gray-300 text-sm font-bold mb-2"
                >Mes</label
              >
              <select
                title="Selecciona Mes"
                [(ngModel)]="selectedMonth"
                (change)="onDateFilterChange()"
                [disabled]="!selectedYear"
                class="w-full px-4 py-2 rounded bg-[#181C1F] border border-[#23272A] text-white"
              >
                <option value="">Todos los meses</option>
                <option *ngFor="let month of months" [value]="month.value">
                  {{ month.label }}
                </option>
              </select>
            </div>
          </div>
        </div>

        <!-- Lista de Nóminas -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <div
            *ngFor="let payroll of filteredPayrolls"
            class="bg-[#23272A] rounded-lg shadow-lg overflow-hidden"
          >
            <div class="p-4">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <h3 class="text-xl font-bold text-white">
                    {{ getEmployeeName(payroll.user_dni!) }}
                  </h3>
                  <p class="text-gray-400">DNI: {{ payroll.user_dni }}</p>
                </div>
              </div>

              <div class="space-y-2 text-sm text-gray-300">
                <p>
                  <span class="font-bold">Fecha:</span>
                  {{ payroll.date | date }}
                </p>
                <p>
                  <span class="font-bold">Periodo:</span><br />
                  {{ payroll.period_in | date }} -
                  {{ payroll.period_out | date }}
                </p>
                <p>
                  <span class="font-bold">Salario Base:</span><br />
                  {{
                    payroll.base_salary | currency : "EUR" : "symbol" : "1.2-2"
                  }}
                </p>
              </div>

              <div class="mt-4 pt-4 border-t border-gray-700">
                <h4 class="text-sm font-bold text-green-400 mb-2">Ingresos</h4>
                <div class="grid grid-cols-2 gap-2 text-sm text-white">
                  <p *ngIf="payroll.bonus_1">
                    Bono 1:
                    {{
                      payroll.bonus_1 | currency : "EUR" : "symbol" : "1.2-2"
                    }}
                  </p>
                  <p *ngIf="payroll.bonus_2">
                    Bono 2:
                    {{
                      payroll.bonus_2 | currency : "EUR" : "symbol" : "1.2-2"
                    }}
                  </p>
                  <p *ngIf="payroll.bonus_3">
                    Bono 3:
                    {{
                      payroll.bonus_3 | currency : "EUR" : "symbol" : "1.2-2"
                    }}
                  </p>
                  <p *ngIf="payroll.advance">
                    Anticipo:
                    {{
                      payroll.advance | currency : "EUR" : "symbol" : "1.2-2"
                    }}
                  </p>
                </div>
              </div>

              <div class="mt-4 pt-4 border-t border-gray-700">
                <h4 class="text-sm font-bold text-red-400 mb-2">Deducciones</h4>
                <div class="grid grid-cols-2 gap-2 text-sm text-white">
                  <p>
                    IRPF:
                    {{ payroll.irpf | currency : "EUR" : "symbol" : "1.2-2" }}
                  </p>
                  <p>
                    S.Social:
                    {{
                      payroll.social_security
                        | currency : "EUR" : "symbol" : "1.2-2"
                    }}
                  </p>
                  <p *ngIf="payroll.deduction_1">
                    Ded 1:
                    {{
                      payroll.deduction_1
                        | currency : "EUR" : "symbol" : "1.2-2"
                    }}
                  </p>
                  <p *ngIf="payroll.deduction_2">
                    Ded 2:
                    {{
                      payroll.deduction_2
                        | currency : "EUR" : "symbol" : "1.2-2"
                    }}
                  </p>
                  <p *ngIf="payroll.deduction_3">
                    Ded 3:
                    {{
                      payroll.deduction_3
                        | currency : "EUR" : "symbol" : "1.2-2"
                    }}
                  </p>
                </div>
                <div class="flex justify-end pt-2">
                  <span class="text-2xl font-bold text-green-400">
                    {{ payroll.total | currency : "EUR" : "symbol" : "1.2-2" }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
      <ng-template #noPriv>
        <div
          class="bg-[#23272A] p-8 rounded-lg shadow-lg text-center text-red-400 text-xl font-bold"
        >
          No tienes privilegios para ver esta sección
        </div>
      </ng-template>
    </ng-container>
  </div>
</div>
